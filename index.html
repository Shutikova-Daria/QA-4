<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å —Ç–æ–≤–∞—Ä—ñ–≤</title>
<link rel="stylesheet" href="style.css">

</head>
<body>
<h2>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å —Ç–æ–≤–∞—Ä—ñ–≤</h2>

<form id="productForm">
  <input type="hidden" id="id">
  <label>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É:</label>
  <input id="name" required>
  <label>–û–ø–∏—Å:</label>
  <textarea id="description"></textarea>
  <label>–¶—ñ–Ω–∞:</label>
  <input id="price" type="number" step="0.01" required>
  <label>–î–∞—Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è:</label>
  <input id="date_added" type="date" required>
  <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
</form>

<hr>

<table>
  <thead>
    <tr>
      <th>–ù–∞–∑–≤–∞</th>
      <th>–û–ø–∏—Å</th>
      <th>–î–∞—Ç–∞</th>
      <th>–¶—ñ–Ω–∞</th>
      <th>–î—ñ—ó</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
let products = [];

function loadProducts() {
  fetch('api.php?action=getProducts')
    .then(res => res.json())
    .then(data => {
      products = data;
      autoSort(); 
      render();
    });
}

function autoSort() {
  products.sort((a, b) => new Date(b.date_added) - new Date(a.date_added));
  products.sort((a, b) => a.name.localeCompare(b.name));
}

function render() {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = products.map(p => `
    <tr>
      <td>${p.name}</td>
      <td>${p.description}</td>
      <td>${p.date_added}</td>
      <td>${p.price}</td>
      <td>
        <button onclick="edit(${p.id})">‚úèÔ∏è</button>
        <button onclick="del(${p.id})">üóëÔ∏è</button>
      </td>
    </tr>
  `).join('');
}

document.getElementById('productForm').onsubmit = e => {
  e.preventDefault();
  const id = document.getElementById('id').value;
  const data = new FormData();
  ['name','description','price','date_added'].forEach(f => data.append(f, document.getElementById(f).value));
  if (id) { data.append('id', id); send('updateProduct', data); }
  else send('addProduct', data);
};

function edit(id) {
  const p = products.find(x => x.id == id);
  for (let f in p) if (document.getElementById(f)) document.getElementById(f).value = p[f];
}

function del(id) {
  if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä?')) return;
  const data = new FormData(); data.append('id', id);
  send('deleteProduct', data);
}

function send(action, data) {
  fetch('api.php?action=' + action, {method:'POST', body:data})
    .then(r => r.text())
    .then(r => {
      if (r === 'OK') {
        loadProducts();  
      }
    });
}

loadProducts();
</script>
</body>
</html>
